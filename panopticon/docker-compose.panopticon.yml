# AUTO-GENERATED FILE. DO NOT EDIT DIRECTLY.
# Source of truth: panopticon/agents.manifest.yaml
# Generator: panopticon/tools/generate_panopticon.py

services:
  mc-redis:
    container_name: mc-redis
    image: redis:7-alpine
    command: ["redis-server", "--appendonly", "yes"]
    volumes:
      - type: bind
        source: ${PANOPTICON_DATA_DIR:-.}/mission-control/redis-data
        target: /data
    restart: unless-stopped
    networks:
      - panopticon

  mc-postgres:
    container_name: mc-postgres
    image: pgvector/pgvector:pg16
    environment:
      POSTGRES_USER: mission_control
      POSTGRES_PASSWORD: mission_control
      POSTGRES_DB: mission_control
    volumes:
      - type: bind
        source: ${PANOPTICON_DATA_DIR:-.}/mission-control/postgres-data
        target: /var/lib/postgresql/data
      - type: bind
        source: ./mission-control/db
        target: /docker-entrypoint-initdb.d
        read_only: true
    restart: unless-stopped
    networks:
      - panopticon

  mission-control-api:
    container_name: mission-control-api
    build:
      context: ../mission_control_api
      dockerfile: Dockerfile
    image: mission-control-api:local
    env_file:
      - ./env/mission-control.env.example
    environment:
      MC_GLOBAL_SKILLS_DIR: /data/global-skills
      MC_AGENT_HOMES_DIR: /data/agent-homes
    volumes:
      - type: bind
        source: ./global-skills
        target: /data/global-skills
        read_only: true
      - type: bind
        source: ${PANOPTICON_DATA_DIR:-.}/agent-homes
        target: /data/agent-homes
    depends_on:
      - mc-redis
      - mc-postgres
    ports:
      - "18910:9090"
    restart: unless-stopped
    networks:
      - panopticon

  mission-control-ui:
    container_name: mission-control-ui
    build:
      context: ../MissionControl
      dockerfile: Dockerfile
    image: mission-control-ui:local
    env_file:
      - ./env/mission-control-ui.env.example
      - ./env/mission-control-ui.env
    volumes:
      - type: bind
        source: ./agents.manifest.yaml
        target: /app/panopticon_agents.manifest.yaml
        read_only: true
    depends_on:
      - mission-control-api
    restart: unless-stopped
    networks:
      - panopticon

  mission-control-gateway:
    container_name: mission-control-gateway
    image: nginx:alpine
    env_file:
      - ./env/mission-control-gateway.env
    volumes:
      - type: bind
        source: ./nginx/mission-control-gateway.conf.template
        target: /etc/nginx/templates/default.conf.template
        read_only: true
      - type: bind
        source: ${PANOPTICON_DATA_DIR:-.}/mission-control/gateway-logs
        target: /var/log/nginx
    depends_on:
      - mission-control-ui
    ports:
      - "18920:80"
    restart: unless-stopped
    networks:
      - panopticon

  mission-control-chat-bridge:
    container_name: mission-control-chat-bridge
    image: python:3.12-alpine
    env_file:
      - ./env/mission-control.env.example
    environment:
      MC_API_URL: http://mission-control-api:9090
      MC_CHAT_GATEWAY_LOG_FILE: /var/log/nginx/chat_access.log
      MC_CHAT_BRIDGE_POLL_SECONDS: "0.5"
      MC_CHAT_BRIDGE_START_MODE: tail
    volumes:
      - type: bind
        source: ./tools/chat_gateway_log_bridge.py
        target: /app/chat_gateway_log_bridge.py
        read_only: true
      - type: bind
        source: ${PANOPTICON_DATA_DIR:-.}/mission-control/gateway-logs
        target: /var/log/nginx
        read_only: true
    command: ["python", "/app/chat_gateway_log_bridge.py"]
    depends_on:
      - mission-control-api
      - mission-control-gateway
    restart: unless-stopped
    networks:
      - panopticon

  mc-heartbeat:
    container_name: mc-heartbeat
    image: python:3.12-alpine
    env_file:
      - ./env/mission-control.env.example
    environment:
      MC_API_URL: http://mission-control-api:9090
      MC_HEARTBEAT_AGENTS: nox,metrics,email,growth,trades,health,writing,personal
      MC_HEARTBEAT_INTERVAL_SECONDS: "60"
    volumes:
      - type: bind
        source: ./tools/heartbeat_emitter.py
        target: /app/heartbeat_emitter.py
        read_only: true
    command: ["python", "/app/heartbeat_emitter.py"]
    depends_on:
      - mission-control-api
    restart: unless-stopped
    networks:
      - panopticon

  mission-control-voice-bridge:
    container_name: mission-control-voice-bridge
    image: ros:humble-ros-base
    profiles: ["voice"]
    env_file:
      - ./env/mission-control.env.example
      - ./env/mission-control-voice-bridge.env.example
    volumes:
      - type: bind
        source: ./tools/voice_ros_event_bridge.py
        target: /app/voice_ros_event_bridge.py
        read_only: true
    command: ["python3", "/app/voice_ros_event_bridge.py"]
    depends_on:
      - mission-control-api
    restart: unless-stopped
    networks:
      - panopticon
  openclaw-nox:
    container_name: openclaw-nox
    build:
      context: ../external/OpenClaw-Docker-CN-IM
      dockerfile: Dockerfile
    image: openclaw-docker-cn-im:local
    cap_add:
      - CHOWN
      - SETUID
      - SETGID
      - DAC_OVERRIDE
    environment:
      HOME: /home/node
      TERM: xterm-256color
    env_file:
      - ./env/nox.env.example
      - ./env/nox.env
    volumes:
      - type: bind
        source: ${PANOPTICON_DATA_DIR:-.}/agent-homes/nox
        target: /home/node/.openclaw
      - type: bind
        source: ${PANOPTICON_DATA_DIR:-.}/workspaces/nox
        target: /home/node/.openclaw/workspace
      - /home/node/.openclaw/extensions
    ports:
      - "18801:26216"
      - "18802:18790"
    init: true
    restart: unless-stopped
    networks:
      - panopticon

  openclaw-metrics:
    container_name: openclaw-metrics
    build:
      context: ../external/OpenClaw-Docker-CN-IM
      dockerfile: Dockerfile
    image: openclaw-docker-cn-im:local
    cap_add:
      - CHOWN
      - SETUID
      - SETGID
      - DAC_OVERRIDE
    environment:
      HOME: /home/node
      TERM: xterm-256color
    env_file:
      - ./env/metrics.env.example
      - ./env/metrics.env
    volumes:
      - type: bind
        source: ${PANOPTICON_DATA_DIR:-.}/agent-homes/metrics
        target: /home/node/.openclaw
      - type: bind
        source: ${PANOPTICON_DATA_DIR:-.}/workspaces/metrics
        target: /home/node/.openclaw/workspace
      - /home/node/.openclaw/extensions
    ports:
      - "18811:26216"
      - "18812:18790"
    init: true
    restart: unless-stopped
    networks:
      - panopticon

  openclaw-email:
    container_name: openclaw-email
    build:
      context: ../external/OpenClaw-Docker-CN-IM
      dockerfile: Dockerfile
    image: openclaw-docker-cn-im:local
    cap_add:
      - CHOWN
      - SETUID
      - SETGID
      - DAC_OVERRIDE
    environment:
      HOME: /home/node
      TERM: xterm-256color
    env_file:
      - ./env/email.env.example
      - ./env/email.env
    volumes:
      - type: bind
        source: ${PANOPTICON_DATA_DIR:-.}/agent-homes/email
        target: /home/node/.openclaw
      - type: bind
        source: ${PANOPTICON_DATA_DIR:-.}/workspaces/email
        target: /home/node/.openclaw/workspace
      - /home/node/.openclaw/extensions
    ports:
      - "18821:26216"
      - "18822:18790"
    init: true
    restart: unless-stopped
    networks:
      - panopticon

  openclaw-growth:
    container_name: openclaw-growth
    build:
      context: ../external/OpenClaw-Docker-CN-IM
      dockerfile: Dockerfile
    image: openclaw-docker-cn-im:local
    cap_add:
      - CHOWN
      - SETUID
      - SETGID
      - DAC_OVERRIDE
    environment:
      HOME: /home/node
      TERM: xterm-256color
    env_file:
      - ./env/growth.env.example
      - ./env/growth.env
    volumes:
      - type: bind
        source: ${PANOPTICON_DATA_DIR:-.}/agent-homes/growth
        target: /home/node/.openclaw
      - type: bind
        source: ${PANOPTICON_DATA_DIR:-.}/workspaces/growth
        target: /home/node/.openclaw/workspace
      - /home/node/.openclaw/extensions
    ports:
      - "18831:26216"
      - "18832:18790"
    init: true
    restart: unless-stopped
    networks:
      - panopticon

  openclaw-trades:
    container_name: openclaw-trades
    build:
      context: ../external/OpenClaw-Docker-CN-IM
      dockerfile: Dockerfile
    image: openclaw-docker-cn-im:local
    cap_add:
      - CHOWN
      - SETUID
      - SETGID
      - DAC_OVERRIDE
    environment:
      HOME: /home/node
      TERM: xterm-256color
    env_file:
      - ./env/trades.env.example
      - ./env/trades.env
    volumes:
      - type: bind
        source: ${PANOPTICON_DATA_DIR:-.}/agent-homes/trades
        target: /home/node/.openclaw
      - type: bind
        source: ${PANOPTICON_DATA_DIR:-.}/workspaces/trades
        target: /home/node/.openclaw/workspace
      - /home/node/.openclaw/extensions
    ports:
      - "18841:26216"
      - "18842:18790"
    init: true
    restart: unless-stopped
    networks:
      - panopticon

  openclaw-health:
    container_name: openclaw-health
    build:
      context: ../external/OpenClaw-Docker-CN-IM
      dockerfile: Dockerfile
    image: openclaw-docker-cn-im:local
    cap_add:
      - CHOWN
      - SETUID
      - SETGID
      - DAC_OVERRIDE
    environment:
      HOME: /home/node
      TERM: xterm-256color
    env_file:
      - ./env/health.env.example
      - ./env/health.env
    volumes:
      - type: bind
        source: ${PANOPTICON_DATA_DIR:-.}/agent-homes/health
        target: /home/node/.openclaw
      - type: bind
        source: ${PANOPTICON_DATA_DIR:-.}/workspaces/health
        target: /home/node/.openclaw/workspace
      - /home/node/.openclaw/extensions
    ports:
      - "18851:26216"
      - "18852:18790"
    init: true
    restart: unless-stopped
    networks:
      - panopticon

  openclaw-writing:
    container_name: openclaw-writing
    build:
      context: ../external/OpenClaw-Docker-CN-IM
      dockerfile: Dockerfile
    image: openclaw-docker-cn-im:local
    cap_add:
      - CHOWN
      - SETUID
      - SETGID
      - DAC_OVERRIDE
    environment:
      HOME: /home/node
      TERM: xterm-256color
    env_file:
      - ./env/writing.env.example
      - ./env/writing.env
    volumes:
      - type: bind
        source: ${PANOPTICON_DATA_DIR:-.}/agent-homes/writing
        target: /home/node/.openclaw
      - type: bind
        source: ${PANOPTICON_DATA_DIR:-.}/workspaces/writing
        target: /home/node/.openclaw/workspace
      - /home/node/.openclaw/extensions
    ports:
      - "18861:26216"
      - "18862:18790"
    init: true
    restart: unless-stopped
    networks:
      - panopticon

  openclaw-personal:
    container_name: openclaw-personal
    build:
      context: ../external/OpenClaw-Docker-CN-IM
      dockerfile: Dockerfile
    image: openclaw-docker-cn-im:local
    cap_add:
      - CHOWN
      - SETUID
      - SETGID
      - DAC_OVERRIDE
    environment:
      HOME: /home/node
      TERM: xterm-256color
    env_file:
      - ./env/personal.env.example
      - ./env/personal.env
    volumes:
      - type: bind
        source: ${PANOPTICON_DATA_DIR:-.}/agent-homes/personal
        target: /home/node/.openclaw
      - type: bind
        source: ${PANOPTICON_DATA_DIR:-.}/workspaces/personal
        target: /home/node/.openclaw/workspace
      - /home/node/.openclaw/extensions
    ports:
      - "18871:26216"
      - "18872:18790"
    init: true
    restart: unless-stopped
    networks:
      - panopticon



networks:
  panopticon:
    driver: bridge
